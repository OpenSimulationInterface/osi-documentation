name: AsciiDoc Documentation Build

on:
  push:


jobs: 
  asciidoctor-build:
    name: Run Asciidoctor on Documentation
    
    runs-on: ubuntu-18.04

    steps:
    # Checkout osi documentation
    - name: Checkout osi-documentation
      uses: actions/checkout@v2
      with:
        submodules: true

    # Checkout all other OSI repositories with branch "migration" and nested into osi-documentation
    - name: Checkout open-simulation-interface
      uses: actions/checkout@v2
      with:
        repository: OpenSimulationInterface/open-simulation-interface
        ref: migration
        path: open-simulation-interface

    - name: Checkout OSI Sensor Model Packaging
      uses: actions/checkout@v2
      with:
        repository: OpenSimulationInterface/osi-sensor-model-packaging
        ref: migration
        path: osi-sensor-model-packaging


    - name: Checkout OSI Validation
      uses: actions/checkout@v2
      with:
        repository: OpenSimulationInterface/osi-validation
        ref: migration
        path: osi-validation


    - name: Checkout OSI Visualizer
      uses: actions/checkout@v2
      with:
        repository: OpenSimulationInterface/osi-visualizer
        ref: migration
        path: osi-visualizer


    - name: Checkout proto2cpp
      uses: actions/checkout@v2
      with:
        repository: OpenSimulationInterface/proto2cpp
        ref: migration
        path: proto2cpp

    # DEBUG: 
    - name: Show checkout result for debugging purposes
      run: | 
        ls -la
        ls -la ..
        
    # run Asciidoctor
    - name: Build HTML
      uses: avattathil/asciidoctor-action@master
      with:
        program: "asciidoctor -D . --backend=html5 index.adoc -o documentation.html"

    - name: Upload HTML Artifact
      uses: actions/upload-artifact@v1
      with:
        name: HTML document
        path: documentation.html

    